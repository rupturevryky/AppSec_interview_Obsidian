# Механизмы безопасности ОС Windows

Безопасность Windows построена по принципу **многоуровневой защиты**, где каждый механизм закрывает свою уязвимость, а вместе они создают комплексный щит. 

В таблице ниже вы найдете все механизмы, сгруппированные по основным категориям.

| Категория                                          | Основной механизм / Подсистема                                                                                                                                                                                                                                                                                                                                                                                               | Краткое описание (Зачем нужен, Что делает, Как работает)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Защита от вредоносных программ и сетевых угроз** | **Microsoft Defender Антивирус**[](https://learn.microsoft.com/ru-ru/defender-endpoint/microsoft-defender-antivirus-windows)                                                                                                                                                                                                                                                                                                 | **Зачем:** Основная встроенная защита от вирусов, шпионского ПО, программ-вымогателей. <br>**Что:** Использует машинное обучение, облачную аналитику и поведенческий анализ для обнаружения и блокировки угроз в реальном времени. <br>**Как:** Сканирует файлы, память и процессы. Работает в активном, пассивном (если есть сторонний антивирус) или отключенном режиме.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                    | **Брандмауэр Защитника Windows**[](https://support.microsoft.com/ru-ru/windows/%D0%B1%D1%80%D0%B0%D0%BD%D0%B4%D0%BC%D0%B0%D1%83%D1%8D%D1%80-%D0%B8-%D0%B7%D0%B0%D1%89%D0%B8%D1%82%D0%B0-%D1%81%D0%B5%D1%82%D0%B8-%D0%B2-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-windows-ec0844f7-aebd-0583-67fe-601ecf5d774f)                  | **Зачем:** Контролирует сетевой трафик для блокировки несанкционированного доступа. <br>**Что:** Фильтрует входящие и исходящие подключения на основе правил (IP, порты, приложения). <br>**Как:** Использует отдельные профили для доменных, частных и общедоступных сетей, обеспечивая разный уровень строгости[](https://support.microsoft.com/ru-ru/windows/%D0%B1%D1%80%D0%B0%D0%BD%D0%B4%D0%BC%D0%B0%D1%83%D1%8D%D1%80-%D0%B8-%D0%B7%D0%B0%D1%89%D0%B8%D1%82%D0%B0-%D1%81%D0%B5%D1%82%D0%B8-%D0%B2-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-windows-ec0844f7-aebd-0583-67fe-601ecf5d774f)[](https://learn.microsoft.com/ru-ru/windows/security/operating-system-security/system-security/windows-defender-security-center/wdsc-firewall-network-protection).                                                                                                                                                                                                      |
|                                                    | **Безопасность устройства (Device Security)**[](https://support.microsoft.com/ru-ru/windows/%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0-%D0%B2-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-windows-afa11526-de57-b1c5-599f-3a4c6a61c5e2) | **Зачем:** Центр управления аппаратными функциями безопасности ПК. <br>**Что:** Отображает состояние и позволяет управлять такими функциями, как TPM, Secure Boot и изоляция ядра.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Аппаратная безопасность и шифрование**           | **Безопасная загрузка (Secure Boot)**[](https://support.microsoft.com/ru-ru/windows/%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0-%D0%B2-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-windows-afa11526-de57-b1c5-599f-3a4c6a61c5e2)         | **Зачем:** Защищает процесс запуска ПК от руткитов. <br>**Что:** Гарантирует, что загружаются только подписанные и доверенные компоненты прошивки, загрузчика и ОС. <br>**Как:** Проверяет цифровые подписи на каждом этапе загрузки, отклоняя несанкционированный код.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                    | **Доверенный платформенный модуль (TPM)**[](https://support.microsoft.com/ru-ru/topic/%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-%D0%B4%D0%BE%D0%B2%D0%B5%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D0%BF%D0%BB%D0%B0%D1%82%D1%84%D0%BE%D1%80%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8C-tpm-705f241d-025d-4470-80c5-4feeb24fa1ee)                                                           | **Зачем:** Криптографический «анклав» для безопасного хранения ключей и данных. <br>**Что:** Микросхема на материнской плате, которая генерирует и хранит ключи шифрования, пароли, биометрические данные. <br>**Как:** Предоставляет защищенное аппаратное хранилище, недоступное для извлечения программным путем. Используется BitLocker, Windows Hello.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                                    | **BitLocker** (Шифрование устройства/диска)[](https://support.microsoft.com/ru-ru/windows/%D0%BE%D0%B1%D0%B7%D0%BE%D1%80-bitlocker-44c0c61c-989d-4a69-8822-b95cd49b1bbf)                                                                                                                                                                                                                                                     | **Зачем:** Полное шифрование диска для защиты данных при потере или краже устройства. <br>**Что:** Шифрует том целиком (например, системный диск). <br>**Как:** Использует ключ, защищенный TPM (или паролем). При включении прозрачно шифрует данные, записываемые на диск.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Виртуализация для безопасности (VBS)**           | **Безопасность на основе виртуализации (VBS)**                                                                                                                                                                                                                                                                                                                                                                               | **Зачем:** Использует гипервизор для создания изолированной, защищенной области памяти. <br>**Что:** Фундамент для изоляции ядра и Credential Guard. <br>**Как:** Аппаратная виртуализация создает безопасный режим выполнения («VTL 1»), куда перемещаются критически важные процессы ОС.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                    | **Изоляция ядра (Kernel Isolation)**                                                                                                                                                                                                                                                                                                                                                                                         | **Зачем:** Защищает ядро ОС (самую привилегированную часть) от компрометации. <br>**Что:** Изолирует процессы ядра в защищенной среде[](https://support.microsoft.com/ru-ru/windows/%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0-%D0%B2-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-windows-afa11526-de57-b1c5-599f-3a4c6a61c5e2). <br>**Как:** Включает **целостность памяти (HVCI)**, которая проверяет все драйверы и код ядра перед выполнением, блокируя не подписанные или модифицированные[](https://support.microsoft.com/ru-ru/windows/%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0-%D0%B2-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C-windows-afa11526-de57-b1c5-599f-3a4c6a61c5e2). |
|                                                    | **Credential Guard**                                                                                                                                                                                                                                                                                                                                                                                                         | **Зачем:** Защищает хэши паролей (NTLM) и данные билетов Kerberos от краж. <br>**Что:** Изолирует процесс `LSA` в защищенной среде VBS. <br>**Как:** Даже если злоумышленник получит права администратора, он не сможет прочитать защищенные учетные данные из обычной памяти.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Целостность системы и кода**                     | **Patch Guard**                                                                                                                                                                                                                                                                                                                                                                                                              | **Зачем:** Защищает целостность ядра Windows от модификации. <br>**Что:** Обнаруживает и блокирует попытки несанкционированного патча (изменения) ядра в памяти. <br>**Как:** Периодически проверяет критически важные структуры данных ядра. Срабатывает при обнаружении изменений, вызывая аварийное завершение работы системы (BSOD).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                    | **Защита от выполнения данных (DEP)**                                                                                                                                                                                                                                                                                                                                                                                        | **Зачем:** Предотвращает запуск кода из областей памяти, предназначенных только для данных. <br>**Что:** Помечает части памяти как непригодные для исполнения (NX — No eXecute). <br>**Как:** Работает на аппаратном уровне с поддержкой ЦП. Блокирует классические атаки, такие как переполнение буфера.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                    | **Контроль учетных записей (UAC)**                                                                                                                                                                                                                                                                                                                                                                                           | **Зачем:** Запрашивает явное согласие пользователя для действий, требующих прав администратора. <br>**Что:** Разделяет права обычного пользователя и администратора. <br>**Как:** При выполнении привилегированной задачи запрашивает подтверждение, временно повышая права (в безопасном рабочем столе).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Контроль доступа и аутентификация**              | **Уровни целостности (Integrity Levels, IL)**                                                                                                                                                                                                                                                                                                                                                                                | **Зачем:** Обеспечивает модель мандатного контроля доступа внутри Windows. <br>**Что:** Назначает процессам и объектам уровень доверия (Low, Medium, High, System). <br>**Как:** Процесс с низким уровнем целостности (например, браузер) не может писать в процесс с высоким уровнем (проводник), даже если права NTFS это позволяют.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                                    | **Маркеры доступа (Access Tokens)**                                                                                                                                                                                                                                                                                                                                                                                          | **Зачем:** Содержит информацию о безопасности для процесса или потока (идентификатор пользователя, группы, привилегии). <br>**Что:** Виртуальный «пропуск». <br>**Как:** При входе в систему создается первичный маркер. Каждый запущенный процесс получает копию этого маркера, определяющую его права.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                    | **Подсистема локальной безопасности (LSASS)**                                                                                                                                                                                                                                                                                                                                                                                | **Зачем:** Центральный орган, управляющий аутентификацией и политиками безопасности. <br>**Что:** Процесс (`lsass.exe`), проверяющий пароли, создает маркеры доступа, записывает события в журнал безопасности. <br>**Как:** Принимает запросы на вход, обрабатывает их (самостоятельно или через модули вроде Kerberos), выдает маркеры.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                    | **Kerberos**                                                                                                                                                                                                                                                                                                                                                                                                                 | **Зачем:** Сетевой протокол для безопасной аутентификации в доменной среде Active Directory. <br>**Что:** Позволяет пользователю один раз войти в систему и получать доступ к сетевым ресурсам без повторного ввода пароля. <br>**Как:** Использует систему билетов, шифрования и центральный сервер (KDC) для проверки подлинности.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                    | **Windows Hello**                                                                                                                                                                                                                                                                                                                                                                                                            | **Зачем:** Беспарольная аутентификация с помощью биометрии или ПИН-кода. <br>**Что:** Позволяет войти в систему по лицу, отпечатку пальца или ПИН-коду. <br>**Как:** Биометрические данные хранятся локально в защищенном хранилище (TPM). ПИН-код привязан к конкретному устройству, что делает его более безопасным, чем пароль.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                    | **AppLocker**                                                                                                                                                                                                                                                                                                                                                                                                                | **Зачем:** Контролирует, какие приложения, скрипты и установщики могут запускаться. <br>**Что:** Система правил, основанных на издателе, хэше или пути к файлу. <br>**Как:** Определяет политику «белого списка». Полезно для предотвращения запуска непроверенного или вредоносного ПО, особенно в корпоративных сетях.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Управление политиками и доступом**               | **Локальные политики безопасности (Local Security Policy)**                                                                                                                                                                                                                                                                                                                                                                  | **Зачем:** Централизованная настройка параметров безопасности на отдельном компьютере. <br>**Что:** Консоль управления (`secpol.msc`), где задаются политики паролей, блокировки учетных записей, аудита, прав пользователей.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                                    | **Политика групп (Group Policy)**                                                                                                                                                                                                                                                                                                                                                                                            | **Зачем:** Централизованное управление настройками безопасности и конфигурацией множества компьютеров в домене. <br>**Что:** Механизм распространения политик через Active Directory. <br>**Как:** Администратор создает объекты групповой политики (GPO), которые автоматически применяются к пользователям и компьютерам в заданных подразделениях.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                    | **Списки управления доступом (ACL)**                                                                                                                                                                                                                                                                                                                                                                                         | **Зачем:** Определяют, кто и что может делать с объектом (файлом, ключом реестра). <br>**Что:** Список записей контроля доступа (ACE), прикрепленный к объекту. <br>**Как:** Каждая **ACE** определяет разрешение (Разрешить/Запретить) для конкретного пользователя или группы (например, «Администраторы: Полный доступ»). **DACL** (дискреционный ACL) определяет права доступа. **SACL** (системный ACL) определяет, какие действия подлежат аудиту.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                    | **AdminSDHolder & SDProp**                                                                                                                                                                                                                                                                                                                                                                                                   | **Зачем:** Защищает привилегированные учетные записи и группы в Active Directory от случайного или злонамеренного изменения прав. <br>**Что:** Специальный объект-контейнер с жесткими ACL. <br>**Как:** Фоновая задача **SDProp** периодически (каждые 60 минут) копирует ACL с объекта `AdminSDHolder` на все защищенные группы (например, «Администраторы домена»), перезаписывая любые изменения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Дополнительные важные механизмы**                | **Песочница Windows (Windows Sandbox)**                                                                                                                                                                                                                                                                                                                                                                                      | **Зачем:** Быстрое создание изолированной, одноразовой среды для запуска непроверенного ПО. <br>**Что:** Легковесная виртуальная машина, интегрированная в Windows. <br>**Как:** Все изменения в песочнице (файлы, установка программ) уничтожаются после ее закрытия.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                                    | **Защита от эксплойтов (Exploit Guard)**                                                                                                                                                                                                                                                                                                                                                                                     | **Зачем:** Набор средств для защиты от конкретных векторов атак. <br>**Что:** Включает: **Управление доступом к папкам (CFG)** для блокировки программ-вымогателей, **Защиту сети** для блокировки исходящих вредоносных подключений, **Защиту от эксплойтов** для настройки политик смягшения (например, для отдельных процессов).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                    | **Служба аттестации удаленного рабочего места (Remote Desktop Services)**                                                                                                                                                                                                                                                                                                                                                    | **Зачем:** Гарантирует, что подключающиеся к корпоративным ресурсам устройства соответствуют стандартам безопасности. <br>**Что:** Проверяет состояние устройства (включен ли антивирус, есть ли TPM) перед предоставлением доступа. <br>**Как:** Интегрируется с политиками условного доступа.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |


---





amc

изоляция ядра - разные уровни ring 0 ring 3

HVSI memory integrety

dep API

labs 

аутентификация в виндовс, её dll

---

когда мы хотим поднять привилегии в windows, нужно поднять привилегии system. Над ней есть ещё более главная учётная запись, работающая в ядре. System работает ещё и в пользовательсом пространстве

kernol mod существует только в пространтсве ядра. она всё контролирует, игнорирую все правила.

ОС всегда пытается защищать объекты в себе. Она делает только то, что в ней зашито и прямо сказано. Есть и двойственные разрешения, но это всегда байпасится.

Чтобы попасть в ядро

будем говорить только о том, как брать систему. есть эксплойты ядра, бут киты, дампы, можно использовать токены пользователя с опасными разрешениями. самое опасное same personate и same ... позволяют поднять уровень привелегий до системы, тк эти привелегии допускают это. 

каждый процесс имеет токен, содержащий информацию об учётной записи. эти токены не безопасны. они могут быть взломаны методом перебора пользователями, не имеющими прав на чтение памяти. обычно админы всегда обладают дополнительные параметры, обращаются к винлокеру, ...

есть тип эксплойтов - картофельный эксплойт. учётные записи служб same personate могут получить. эти эксплойты как работают? это не обязательно админские УЗ. пользователь может заполучить какой нибудь сервис, который работает с опасными привилегиями. например mssql работает с sign primary token и same personate. можно внедрить функцию исполнения команд и так достать эксплойт, поднимающий привелегии system. чтого таких служб

есть привилегия sa dbug - она может назначаться через групповые политики и по умолчанию предоставляется только администраторам. она позволяет отлаживать системы, читать и писать в память. можно получить хэши ntlm v2 и другие хэши (какие). можно progdump-ом дампонуль lsal. после дампа можно локально в офлайн дешифровать его, например с помощью mimikatz. с помощью этой привилегии можно выполнять rce. можно от system выдавать себе привилегии через запущенные процессы. есть распространённый скрипт, которым берётся список процессов, берёт, обычно winlogon, этот скрипт от этого процесса открывает терминал с доступом, например к lsasl

каждый объект винды прошедший аутентификацию в системе попадает в lsasl. 

Cetake owner ship privelege - даёт право собственности на любой защищаемый объект. имеет права write owner над объектом. 

встроенные группы виндовс - операторы печати, читатели журнала, администраторы DNS и тд.

бэкап оператор - бэкапит диск, читает все его данные, в том числе улий, ntds dit, иногда пароли в открытом виде.

операторы печати - группа с высокими привилегиями. даёт привелегию на загрузку любого драйвера. есть разновидность поднятия привилегий через загружку уязвимых драйверов. их много на гитхабе. например драйвер cup com sys, который позволяет выполнять любому пользователю код от system.

