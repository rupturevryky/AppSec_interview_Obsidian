
---

### **Как мы проводим сканирования: методика и инструменты**

Для комплексной оценки безопасности необходим пул инструментов, которые дополняют друг друга. Ни один сканер не даёт полной картины, поэтому мы комбинируем решения для глубокого анализа сетей, веб-приложений, Active Directory и других активов.

---
#### **1. Общая подготовка и планирование**

Перед любым сканированием критически важен этап подготовки:

- **Определение Scope (границ):** Чёткое выделение целевых систем, сетей и приложений. Важно выявить критически важные активы, которые нельзя сканировать в рабочее время или агрессивными методами.
- **Получение разрешений:** Все действия согласуются с владельцами инфраструктуры. Несанкционированное сканирование = атака.
- **Выбор шаблонов и политик:** Настройка сканеров под конкретные цели (например, "щадящая проверка web-сервера" или "глубокий аудит сети").

---

#### **2. Сканирование веб-приложений**

Цель — выявление уязвимостей на уровне приложения (сервера, API, клиентской части).

- **Автоматизированное сканирование:** Используются сканеры (например, **Burp Suite Professional**, **Acunetix**, **Nessus**, **OpenVAS**) для поиска известных уязвимостей (OWASP Top 10, CVE). Автоматизация эффективна против "low-hanging fruit" (очевидных проблем).
- **Динамический анализ (DAST):** Тестирование работающего приложения "снаружи", как это сделал бы злоумышленник.
- **Верификация и снижение ложных срабатываний:** Автоматические отчёты всегда проверяются вручную. Критичный этап — отделить реальные уязвимости от ложных сигналов.
- **Облачные платформы:** Сервисы вроде **Qualys** или **Rapid7 InsightVM** (Nexpose) удобны для постоянного мониторинга и управления уязвимостями.

---

#### **3. Сканирование сети и инфраструктуры**

Цель — составление карты сети, обнаружение активных хостов, открытых портов, сервисов и их уязвимостей.

**А. Обнаружение активов (Discovery):**

- **Проверка "живых" хостов:** Используются не только ICMP-эхо-запросы (тип 8/0), которые часто блокируются, но и другие типы ICMP (например, тип 13/14 — временная метка), а также TCP/UDP-прокобы на ключевые порты.
- **Анализ отпечатков (Fingerprinting):** Определение ОС и версий сервисов (SMB, FTP, SSH, RDP) по ответам сетевых стеков. Инструменты: **Nmap**, **Masscan** (для очень быстрого сканирования портов).
- **Поиск в открытых источниках (OSINT):** Использование **Shodan**, **Censys** для поиска "отпечатков" наших систем в интернете (неконтролируемо открытые порты, утечки данных).

**Б. Анализ портов и сервисов:**

- **Определение состояния портов:** `open` (открыт), `closed` (закрыт), `filtered` (заблокирован фаерволом), `unfiltered` (доступен для проверки).
- **Понимание топологии:** Анализ маршрутов, наличие NAT, балансировщиков нагрузки.

**В. Обход систем защиты (IPS/IDS, Фаерволы):**  
Современная защита активно мешает сканированию. Методики уклонения:

- **Изменение временных параметров:** Увеличение таймаутов (`-T` в Nmap), уменьшение скорости отправки пакетов.
- **Фрагментация пакетов:** Разбиение сканирующих пакетов на мелкие фрагменты, чтобы обойти сигнатурный анализ.
- **Использование различных методов сканирования:** Например, TCP ACK, Window, Maimon сканы для обхода stateful-фаерволов.
- **Источники трафика:** Смена IP-адресов через прокси-цепи (например, **Proxychains**), использование сетей Tor (хотя это медленно) для скрытия исходной точки сканирования.

**Г. Работа с IPv6:**  
Требует отдельного внимания. Важно:

- Определять ASN (Autonomous System Number), искать элиасы (алиасы) адресов.
- Проверять все типы DNS-записей (AAAA).
- Применять те же методики сканирования (UDP/TCP) и уклонения, что и для IPv4.

---

### 3.1. Обход IPS/IDS через ответ от одного порта

**Суть:** Современные системы IPS/IDS легко обнаруживают классическое "грубое" сканирование, когда сканер быстро опрашивает тысячи портов на одном хосте. Это выглядит как явная атака.

**Как работает обход:**  
Чтобы выглядеть как легитимный (или малозаметный) трафик, сканирование маскируют под нормальную активность. Ключевая идея — **не вызывать подозрений у алгоритмов обнаружения аномалий**.

**Конкретный пример с "ответом от одного порта":**

1. **Вместо:** Быстрая последовательность запросов на порты 21, 22, 23, 80, 443, 8080... за секунду.
2. **Делают:** Сканирование растягивают во времени и пространстве.
    - **Порт 80 (HTTP):** Отправляют один-два HTTP-запроса. Получают нормальный ответ от веб-сервера.
    - **IPS/IDS видят:** "Обычный пользователь зашёл на сайт". Флаг атаки не поднимается.
    - **Через несколько минут/часов с ДРУГОГО IP-адреса (или после паузы):** Проверяют порт 443 (HTTPS). Снова получают легитимный ответ.
    - **Ещё через время:** Проверяют порт 22 (SSH) специально сконфигурированным "вялым" запросом.

**Как это помогает обойти защиту:**

- **Low and Slow (Медленно и низко):** Сканирование происходит очень медленно, с большими паузами.
- **Разделение по источникам:** Запросы идут с разных IP-адресов (через прокси, облачные инстансы).
- **Имитация легитимного трафика:** Запросы к портам 80/443 выглядят как обычный браузерный трафик, к порту 22 — как попытка подключения клиента.

**Итог:** Цель — получить от каждого целевого порта **ровно один корректный ответ**, достаточный для определения его состояния и сервиса, но растянуть эти запросы так, чтобы они не складывались в картину сканирования в системе безопасности.

---

### 3.2. Уклонение через параллельные задачи и потоки

Это две противоположные, но объединяемые тактики.

**А. Параллельные задачи (много хостов, мало портов)**

- **Как работает:** Сканер не атакует один хост последовательно. Вместо этого он **одновременно** проверяет ОДИН конкретный порт (например, 443) на БОЛЬШОМ количестве хостов (например, на 1000 машинах в сети).
    
- **Почему это эффективно для уклонения:**
    
    - Для IPS/IDS на каждом отдельном хосте это выглядит как **одно легитимное подключение**.
    - Сложно выявить глобальную закономерность, потому что атака распределена по множеству жертв.
    - Это похоже на горизонтальное сканирование, которое сложнее детектировать правилами, заточенными под вертикальное сканирование (один хост -> много портов).

**Б. Параллельные потоки (один хост, "размазанный" трафик)**

- **Как работает:** Вместо отправки пакетов из одного источника в строгой последовательности, сканер создает **многопоточность**.
    
    - Каждый поток работает со своими таймингами, случайными задержками.
    - Пакеты приходят к цели не равномерным предсказуемым потоком, а вразнобой, имитируя фоновый шум сети или активность нескольких разных пользователей.
        
- **Почему это эффективно:**
    
    - Ломает сигнатурный анализ, ищущий предсказуемые шаблоны пакетов.
    - Затрудняет анализ временных меток (тайминговой сигнатуры) сканирования.
    - Позволяет "размазать" сканирование одного хоста во времени так, чтобы он не попал в лимиты по количеству подключений/пакетов в единицу времени (Rate Limiting).

**Аналог из жизни:** Вместо того чтобы один человек быстро обойти все квартиры в подъезде (это заметно), можно:

1. **(Параллельные задачи)** Отправить по одному курьеру в каждый подъезд района, чтобы каждый проверил только квартиру №5.
2. **(Параллельные потоки)** Отправить группу людей в один подъезд, но они будут заходить в разные квартиры в случайное время, притворяясь гостями.

---

### 3. 3. Что такое Hidden Proxy (Скрытый прокси)?

**Hidden Proxy** — это общее название для сервисов или цепочек прокси-серверов, которые **предназначены для максимальной анонимизации исходного источника трафика**. Их ключевая задача — **скрыть IP-адрес и личность инициатора запроса**.

**Как это работает и чем отличается от обычного прокси:**

1. **Цепочка (Каскад):** Hidden Proxy часто означает не один сервер, а цепочку (например, **Tor** — это сеть из нескольких узлов). Трафик прыгает через 3+ случайных сервера в разных юрисдикциях.
2. **Шифрование:** Между звеньями цепочки трафик шифруется. Каждый следующий узел знает только IP предыдущего, но не исходного.
3. **Динамическая смена IP:** Некоторые сервисы (например, **ресidential VPN** или **мобильные прокси**) автоматически меняют ваш выходной IP-адрес каждые несколько минут/секунд, что крайне затрудняет блокировку.
4. **Поддержка протоколов:** Работают не только с HTTP, но и с любым трафиком (TCP/UDP), что позволяет через них направлять сканирующие утилиты (например, через **Proxychains**).

**Зачем это нужно в сканировании:**

- **Сокрытие источника:** Чтобы целевая система не могла заблокировать ваш реальный IP.
- **Обход географических/сетевых блокировок:** Выход в сеть с IP другой страны или провайдера.
- **Эмуляция распределенной атаки:** Когда каждый запрос в рамках сканирования приходит с нового IP-адреса, это кардинально усложняет жизнь IPS.

**Важный нюанс:**

- **Скорость:** Такие прокси (особенно Tor или бесплатные каскады) **очень медленные**. Они непригодны для быстрого или широкомасштабного сканирования.
- **Надежность:** Соединение может рваться, пакеты теряться.

---

#### **4. Ключевые инструменты и базы знаний**

- **Сканеры уязвимостей:** **Nessus** (коммерческий, обширные базы), **OpenVAS** (открытый аналог). Побеждает тот, чьи базы (сигнатуры) полнее и актуальнее.
- **Сетевые сканеры:** **Nmap** (золотой стандарт), **Masscan** (для сверхбыстрых обзоров).
- **Базы данных уязвимостей:** **Rapid7 Nexpose/InsightVM**, **CVE Details**, **NVD**. **Rapid7** действительно обладает отличной исследовательской базой.
- **Руководства и мануалы:** Официальная документация, ресурсы вроде **0xpat**, **Pentester Academy** — незаменимы для изучения продвинутых техник, особенно по уклонению от фаерволов и работе с IPv6.


**Вывод:** Сканирование — это не просто запуск программы. Это методологический процесс, включающий планирование, выбор правильных инструментов под задачу, адаптацию к защите цели и тщательный анализ результатов. Глубина сканирования напрямую определяет, сколько реальных, эксплуатируемых уязвимостей будет обнаружено, а не просто составлен список потенциальных CVE.